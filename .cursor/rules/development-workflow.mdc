---
description: 개발 워크플로우 및 자동화 가이드, GitHub Actions 워크플로우
globs: 
alwaysApply: false
---
# Development Workflow and Automation Guide

## PR-Based Development Workflow with Develop Branch (Recommended)

### 1. Feature Development with Changeset Accumulation

**Step-by-step workflow for each feature/fix:**

```bash
# 1. Create feature branch from develop
git checkout develop
git pull origin develop
git checkout -b feature/your-feature-name

# 2. Develop your feature
# ... make code changes ...

# 3. Create changeset for your changes
pnpm changeset
# Select packages: cssma
# Select change type: patch/minor/major
# Write clear description of changes

# 4. Commit changes including changeset
git add .
git commit -m "feat: add your feature

- Implement feature X
- Add changeset for version bump"

# 5. Push branch and create PR to develop
git push origin feature/your-feature-name
# Create PR targeting develop branch (NOT main)
```

### 2. PR Review and Merge Process

```mermaid
graph TD
    A[Create feature branch from develop] --> B[Develop feature]
    B --> C[Create changeset]
    C --> D[Commit & push]
    D --> E[Create PR to develop]
    E --> F[Code review]
    F --> G{Review approved?}
    G -->|No| H[Address feedback]
    H --> F
    G -->|Yes| I[Merge PR to develop]
    I --> J[Changeset accumulated in develop]
    J --> K[Multiple features ready?]
    K -->|No| L[Continue development]
    L --> A
    K -->|Yes| M[Create Release PR: develop → main]
    M --> N[Review & merge Release PR]
    N --> O[GitHub Actions trigger]
    O --> P[NPM deployment]
```

### 3. Changeset Management per PR

#### Individual PR Changeset Strategy

Each PR should include its own changeset file:

```bash
# Example: feature/live-preview PR
.changeset/
├── brave-lions-dance.md    # Live preview feature
└── config.json

# Example: fix/css-parser PR  
.changeset/
├── brave-lions-dance.md    # Previous feature
├── tiny-cats-jump.md       # CSS parser fix
└── config.json
```

#### Changeset Naming Convention

```bash
# Changeset files are auto-generated with random names
# Content is what matters:

---
"cssma": minor
---

Add live CSS preview system

- Implement real-time preview component
- Add debounced updates (300ms)
- Include error handling and loading states
```

### 4. Changeset Accumulation in Develop Branch

**Scenario: Multiple features before next release**

```bash
# develop branch accumulates changesets:

# PR #1: feature/live-preview → develop
.changeset/brave-lions-dance.md (minor)

# PR #2: fix/css-parser-bug → develop  
.changeset/tiny-cats-jump.md (patch)

# PR #3: feature/new-converter → develop
.changeset/loud-dogs-sing.md (minor)

# develop branch now contains:
.changeset/
├── brave-lions-dance.md (minor)
├── tiny-cats-jump.md (patch)
├── loud-dogs-sing.md (minor)
└── config.json

# When ready for release:
# → Create PR: develop → main
# → GitHub Actions processes all changesets
# → Calculates final version (0.1.0 → 0.2.0)
# → NPM deployment
```

### 5. Branch Protection Rules (Recommended)

Set up branch protection for main branch:

```yaml
# GitHub Settings → Branches → main
protection_rules:
  require_pull_request_reviews: true
  required_approving_review_count: 1
  dismiss_stale_reviews: true
  require_code_owner_reviews: false
  require_status_checks: true
  required_status_checks:
    - "build"
    - "test"
    - "type-check"
  enforce_admins: false
  allow_force_pushes: false
  allow_deletions: false
```

### 6. PR Template with Changeset Checklist

PR template is available at `.github/pull_request_template.md` with comprehensive checklist including changeset requirements.

### 7. Release Management Process

**When to create a release:**

```bash
# Check accumulated changesets in develop
pnpm changeset:status

# Review what will be released
git log main..develop --oneline

# Create release PR when ready
# 1. Create PR: develop → main
# 2. Title: "Release v0.x.x"
# 3. Review all accumulated changes
# 4. Merge to trigger deployment
```

### 8. Real-world Example Workflow

**Example: Adding multiple features before release**

```bash
# Feature 1: CSS Grid converter
git checkout develop
git pull origin develop
git checkout -b feature/add-grid-converter
# ... develop feature ...
pnpm changeset # minor
git commit -m "feat: add CSS Grid converter support"
git push origin feature/add-grid-converter
# Create PR to develop → merge

# Feature 2: Bug fix
git checkout develop
git pull origin develop
git checkout -b fix/parser-edge-case
# ... fix bug ...
pnpm changeset # patch
git commit -m "fix: handle edge case in CSS parser"
git push origin fix/parser-edge-case
# Create PR to develop → merge

# Feature 3: New component
git checkout develop
git pull origin develop
git checkout -b feature/new-component-type
# ... develop feature ...
pnpm changeset # minor
git commit -m "feat: add new component type support"
git push origin feature/new-component-type
# Create PR to develop → merge

# Ready for release
git checkout develop
pnpm changeset:status
# Shows: 2 minor + 1 patch = minor release (0.1.0 → 0.2.0)

# Create release PR
# develop → main
# Title: "Release v0.2.0"
# Merge → triggers GitHub Actions → NPM deployment
```

**Result**: Single release with multiple features, version bump from `0.1.0` → `0.2.0`.

## GitHub Actions Workflows

### 1. Release Automation ([.github/workflows/release.yml](mdc:.github/workflows/release.yml))

Fully automated package deployment system:

```yaml
# Trigger: main branch push
on:
  push:
    branches: [main]

# Key steps:
# 1. Install dependencies (pnpm v9)
# 2. Build packages
# 3. Process changesets
# 4. NPM deployment
# 5. Create GitHub release
```

#### Required Secrets

- `NPM_TOKEN`: NPM deployment token (Automation type)
- `GITHUB_TOKEN`: Auto-provided (for PR creation, release creation)

#### Permission Settings

```yaml
permissions:
  contents: write      # Git tag creation
  pull-requests: write # Release PR creation
  issues: write        # Issue management
```

### 2. Workflow Execution Process

```mermaid
graph TD
    A[main branch push] --> B[GitHub Actions trigger]
    B --> C[Install dependencies]
    C --> D[Build packages]
    D --> E[Check changesets]
    E --> F{Changesets exist?}
    F -->|Yes| G[Create Release PR]
    F -->|No| H[End workflow]
    G --> I[Wait for PR merge]
    I --> J[PR merged]
    J --> K[NPM deployment]
    K --> L[Create GitHub release]
    K --> M[Create Git tags]
```

## Changeset Management

### 1. Configuration File ([.changeset/config.json](mdc:.changeset/config.json))

```json
{
  "changelog": "@changesets/cli/changelog",
  "commit": false,
  "access": "public",
  "baseBranch": "main",
  "updateInternalDependencies": "patch",
  "ignore": ["figmai-landing", "cssma-plugin"],
  "snapshot": {
    "useCalculatedVersion": true
  }
}
```

#### Key Configuration Explanations

- `ignore`: Packages not to deploy (private packages)
- `updateInternalDependencies`: Internal dependency update method
- `snapshot`: Snapshot version calculation method

### 2. Changeset Creation Guide

```bash
# Interactive changeset creation
pnpm changeset

# Selection process:
# 1. Select changed packages (cssma)
# 2. Select change type (patch/minor/major)
# 3. Write change summary
# 4. Confirm and create
```

#### Change Type Criteria

| Type | When to Use | Example |
|------|-------------|---------|
| **patch** | Bug fixes, documentation updates | 0.1.1 → 0.1.2 |
| **minor** | New feature additions | 0.1.1 → 0.2.0 |
| **major** | Breaking changes | 0.1.1 → 1.0.0 |

### 3. Changeset File Structure

```markdown
---
"cssma": patch
---

Add real-time CSS preview system

- Implement LivePreview component
- Apply 300ms debouncing
- Add error handling and loading states
```

## Package Management

### 1. Monorepo Structure

```
packages/
  cssma/           # Core library (deployed)
apps/
  cssma-plugin/    # Figma plugin (not deployed)
  figmai-landing/  # Landing page (not deployed)
```

### 2. Dependency Management

#### Root package.json Scripts

```json
{
  "scripts": {
    "changeset": "changeset",
    "changeset:version": "changeset version",
    "changeset:publish": "changeset publish",
    "changeset:status": "changeset status",
    "release": "pnpm build && pnpm changeset:publish",
    "build": "pnpm --filter cssma build",
    "build:all": "pnpm -r build"
  }
}
```

#### pnpm Workspace Configuration

```yaml
# pnpm-workspace.yaml
packages:
  - 'packages/*'
  - 'apps/*'
```

### 3. Build Optimization

```bash
# Build specific package only (for deployment)
pnpm --filter cssma build

# Build all (for development)
pnpm build:all

# Parallel build
pnpm -r --parallel build
```

## Version Management Strategy

### 1. Semantic Versioning

```
MAJOR.MINOR.PATCH
  |     |     |
  |     |     └─ Bug fixes
  |     └─ New features (backward compatible)
  └─ Breaking changes
```

### 2. Branch Strategy

```
main                 # Stable version, production releases only
├── develop          # Integration branch, changeset accumulation
│   ├── feature/xxx  # New feature development
│   ├── fix/xxx      # Bug fixes
│   └── hotfix/xxx   # Critical fixes
└── release/xxx      # Release preparation (optional)
```

#### Branch Purposes

- **main**: Production-ready code, only receives merges from develop
- **develop**: Integration branch where all features are merged and changesets accumulate
- **feature/**: New feature development, merged to develop
- **fix/**: Bug fixes, merged to develop
- **hotfix/**: Critical production fixes, can be merged directly to main if urgent

### 3. Tag Management

```bash
# Auto-generated tag format
v0.1.0, v0.1.1, v0.1.2, ...

# Check tags
git tag -l

# Checkout to specific tag
git checkout v0.1.2
```

## Automation Troubleshooting

### 1. GitHub Actions Failure Causes

#### NPM Deployment Failure
```bash
# Cause: NPM_TOKEN expired or incorrect configuration
# Solution: Generate new token in NPM and update GitHub Secrets
```

#### PR Creation Failure
```bash
# Cause: Insufficient GitHub Actions permissions
# Solution: Manual PR creation or use PAT
```

#### Build Failure
```bash
# Cause: pnpm version mismatch
# Solution: Ensure pnpm v9 usage in GitHub Actions
```

### 2. Common Solutions

```bash
# 1. Test build locally
pnpm install --no-frozen-lockfile
pnpm build

# 2. Check changeset status
pnpm changeset:status

# 3. Manual version update (for testing)
pnpm changeset:version

# 4. Clear dependency cache
pnpm store prune
```

### 3. Monitoring and Notifications

#### GitHub Actions Status Check
- Monitor workflow execution status in Actions tab
- Automatic email notifications on failure

#### NPM Package Status
```bash
# Check latest version
npm view cssma version

# Deployment history
npm view cssma versions --json
```

## Development Environment Setup

### 1. Local Development Environment

```bash
# 1. Clone repository
git clone https://github.com/easylogic/cssma.git
cd cssma

# 2. Install dependencies
pnpm install

# 3. Run development server
pnpm dev

# 4. Run tests
pnpm test
```

### 2. Environment Variables

```bash
# .env.local (for local development)
NODE_ENV=development
FIGMA_ACCESS_TOKEN=your_token_here

# GitHub Secrets (for deployment)
NPM_TOKEN=npm_xxx
GITHUB_TOKEN=ghp_xxx (auto-provided)
```

### 3. IDE Configuration

#### VSCode Recommended Extensions

```json
{
  "recommendations": [
    "ms-vscode.vscode-typescript-next",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "ms-playwright.playwright"
  ]
}
```

## Performance Monitoring

### 1. Build Performance

```bash
# Measure build time
time pnpm build

# Bundle size analysis
pnpm build --analyze
```

### 2. Deployment Performance

- Monitor GitHub Actions execution time
- Track NPM deployment success rate
- Optimize dependency installation time

Follow this guide to maintain a stable and efficient development workflow.
