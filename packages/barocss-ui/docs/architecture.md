# Director Architecture

## ê°œìš”

DirectorëŠ” AI ì—ì´ì „íŠ¸ê°€ ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜í•˜ëŠ” ëŸ°íƒ€ì„ì…ë‹ˆë‹¤. ì´ ì‹œìŠ¤í…œì€ AIì™€ ì‚¬ìš©ì ê°„ ìƒí˜¸ì‘ìš©ì„ ì¡°ìœ¨í•˜ê³ , ì‹¤ì‹œê°„ìœ¼ë¡œ UIë¥¼ ìƒì„±/ìˆ˜ì •/ì œê±°í•©ë‹ˆë‹¤. ë Œë”ë§ì€ `Stage`ê°€ ë‹´ë‹¹í•˜ë©°, DirectorëŠ” DOMì— ì§ì ‘ ì ‘ê·¼í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**ì¤‘ìš”**: DirectorëŠ” ì™¸ë¶€ Agentì™€ì˜ í†µì‹  ì¸í„°í˜ì´ìŠ¤ë§Œ ì œê³µí•˜ë©°, ì‹¤ì œ AI API í˜¸ì¶œì´ë‚˜ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì€ ì™¸ë¶€ì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤. Third-party Agent ë˜í¼ë¥¼ í†µí•´ ê¸°ì¡´ AI ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ì‰½ê²Œ ì—°ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## íŒ¨í‚¤ì§€ êµ¬ì¡°

DirectorëŠ” ëª¨ë“ˆí™”ëœ íŒ¨í‚¤ì§€ êµ¬ì¡°ë¡œ ì„¤ê³„ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

```
@barocss/ui (í•µì‹¬)
â”œâ”€â”€ @barocss/openai (OpenAI ë˜í¼)
â”œâ”€â”€ @barocss/anthropic (Claude ë˜í¼)  
â””â”€â”€ @barocss/google (í–¥í›„ ì¶”ê°€ ê°€ëŠ¥)
```

### í•µì‹¬ íŒ¨í‚¤ì§€ (@barocss/ui)
- **Director**: ë©”ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
- **Stage**: ë Œë”ë§ ì„œí”¼ìŠ¤ (DOM/Renderer ë³´ìœ )
- **AgentCommunicationInterface**: Agent í†µì‹  ì¸í„°í˜ì´ìŠ¤
- **ThirdPartyAgent**: Third-party Agent ì¸í„°í˜ì´ìŠ¤
- **SceneManager**: ì”¬ ê´€ë¦¬
- **ContextManager**: ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬
- **UIRenderer**: UI ë Œë”ë§ ì—”ì§„ (Stageê°€ ì‚¬ìš©)

### AI ì œê³µì—…ì²´ë³„ ë˜í¼ íŒ¨í‚¤ì§€
- **@barocss/openai**: OpenAI SDK ë˜í¼
- **@barocss/anthropic**: Anthropic Claude SDK ë˜í¼
- **@barocss/google**: Google Gemini SDK ë˜í¼ (í–¥í›„)

## í•µì‹¬ ì„¤ê³„ ì›ì¹™

### 1. ê³„ì¸µí™”ëœ ì•„í‚¤í…ì²˜ (Layered Architecture)
- **í†µì‹  ì¸í„°í˜ì´ìŠ¤ ê³„ì¸µ**: AI ì—ì´ì „íŠ¸ì™€ì˜ í†µì‹  ì¸í„°í˜ì´ìŠ¤ (ì‹¤ì œ ì—°ê²°ì€ ì™¸ë¶€ì—ì„œ ê´€ë¦¬)
- **ìƒíƒœ ê´€ë¦¬ ê³„ì¸µ**: ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœì˜ ì¤‘ì•™í™”ëœ ê´€ë¦¬
- **UI ê´€ë¦¬ ê³„ì¸µ**: ë™ì  UI ì»´í¬ë„ŒíŠ¸ì˜ ìƒì„± ë° ê´€ë¦¬
- **ìƒí˜¸ì‘ìš© ê³„ì¸µ (Interaction Layer)**: ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬, ìƒíƒœ ê´€ë¦¬, ì—°ì† ëŒ€í™”
- **ë Œë”ë§ ê³„ì¸µ (Rendering Layer)**: AI ì‘ë‹µì„ ì‹¤ì œ UIë¡œ ë³€í™˜ ë° ë Œë”ë§

### 2. ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ (Event-Driven Architecture)
- ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ê°„ í†µì‹ ì€ ì´ë²¤íŠ¸ë¥¼ í†µí•´ ì´ë£¨ì–´ì§
- ëŠìŠ¨í•œ ê²°í•©ìœ¼ë¡œ í™•ì¥ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„± í™•ë³´
- ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”

### 3. ìƒíƒœ ë¶ˆë³€ì„± (Immutable State)
- ëª¨ë“  ìƒíƒœ ë³€ê²½ì€ ë¶ˆë³€ ê°ì²´ë¥¼ í†µí•´ ì´ë£¨ì–´ì§
- ì˜ˆì¸¡ ê°€ëŠ¥í•œ ìƒíƒœ ê´€ë¦¬
- ë””ë²„ê¹… ë° í…ŒìŠ¤íŠ¸ ìš©ì´ì„±

## ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Director                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Third-party Agent Layer                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ @barocss/openai â”‚  â”‚@barocss/anthropicâ”‚ â”‚@barocss/... â”‚            â”‚
â”‚  â”‚   (OpenAI)      â”‚  â”‚    (Claude)     â”‚ â”‚  (Others)   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Communication Interface Layer                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚ThirdPartyAgent  â”‚  â”‚AgentCommAdapter â”‚                             â”‚
â”‚  â”‚   Interface     â”‚  â”‚                 â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Scene/State/Interaction Management                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Scene Manager   â”‚  â”‚ Context Manager â”‚  â”‚ Action/Event Handling â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ events/updates
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                Stage                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   UIRenderer (DOM)     â”‚   â”‚  DOM Delegation (data-action, form) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                               DOM
```

## ì‹¤ì œ ë™ì‘ í”Œë¡œìš° (ê²€ì¦ ì™„ë£Œ)

### ì „ì²´ AI Agent OS í”Œë¡œìš°

```
[ì‚¬ìš©ì ìš”ì²­] â†’ [Director] â†’ [SceneManager] â†’ [AI í†µì‹ ] â†’ [Scene ìƒì„±] â†’ [Stage ë Œë”ë§] â†’ [DOM] â†’ [ì‚¬ìš©ì ìƒí˜¸ì‘ìš©] â†’ [ìˆœí™˜]
```

### ìƒì„¸ ì‹¤í–‰ íë¦„

#### 1. ì‚¬ìš©ì ìš”ì²­ë¶€í„° UI ë Œë”ë§ê¹Œì§€

```
ì‚¬ìš©ì ì…ë ¥: director.request("ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì„ ë§Œë“¤ì–´ì¤˜")
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Director (ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°)                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. request(userInput) ì ‘ìˆ˜                               â”‚ â”‚
â”‚ â”‚ 2. ì´ˆê¸°í™” ìƒíƒœ í™•ì¸                                     â”‚ â”‚
â”‚ â”‚ 3. SceneManager.request() í˜¸ì¶œ                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SceneManager (Scene ìƒëª…ì£¼ê¸° ê´€ë¦¬)                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. ConversationChain í™•ì¸/ìƒì„±                          â”‚ â”‚
â”‚ â”‚ 2. ContextAggregatorë¡œ ì´ì „ ì»¨í…ìŠ¤íŠ¸ ì§‘ê³„               â”‚ â”‚
â”‚ â”‚ 3. AIRequestBuilderë¡œ AI ìš”ì²­ ìƒì„±                      â”‚ â”‚
â”‚ â”‚ 4. Director.sendRequest()ë¡œ AI í†µì‹                      â”‚ â”‚
â”‚ â”‚ 5. createSceneFromAIResponse() ì‹¤í–‰                    â”‚ â”‚
â”‚ â”‚ 6. ì•¡ì…˜ ì¶”ì¶œ: extractActionsFromHTML()                 â”‚ â”‚
â”‚ â”‚ 7. Scene ê°ì²´ ë°˜í™˜                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI í†µì‹  ë ˆì´ì–´                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ AgentCommunicationInterface                             â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ Mock Agent (í…ŒìŠ¤íŠ¸)                                 â”‚ â”‚
â”‚ â”‚ â”œâ”€â”€ OpenAI Adapter (í”„ë¡œë•ì…˜)                           â”‚ â”‚
â”‚ â”‚ â””â”€â”€ Anthropic Adapter (í”„ë¡œë•ì…˜)                        â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚ ì‘ë‹µ í˜•íƒœ:                                              â”‚ â”‚
â”‚ â”‚ {                                                       â”‚ â”‚
â”‚ â”‚   data: {                                               â”‚ â”‚
â”‚ â”‚     result: {                                           â”‚ â”‚
â”‚ â”‚       title: "ğŸ›ï¸ AI ì‡¼í•‘ëª°",                          â”‚ â”‚
â”‚ â”‚       ui: { type: "html", content: "<div>..." },       â”‚ â”‚
â”‚ â”‚       state: { cart: [], products: [...] }             â”‚ â”‚
â”‚ â”‚     }                                                   â”‚ â”‚
â”‚ â”‚   }                                                     â”‚ â”‚
â”‚ â”‚ }                                                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage (ë Œë”ë§ ì„œí”¼ìŠ¤)                                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. stage.render(scene) í˜¸ì¶œ                             â”‚ â”‚
â”‚ â”‚ 2. UIRenderer.renderScene() ì‹¤í–‰                       â”‚ â”‚
â”‚ â”‚ 3. extractAIHtmlContent(scene) ì‹¤í–‰                    â”‚ â”‚
â”‚ â”‚ 4. createSceneElement() - DOM ìš”ì†Œ ìƒì„±                â”‚ â”‚
â”‚ â”‚ 5. attachActionHandlers() - ì´ë²¤íŠ¸ ìœ„ì„                â”‚ â”‚
â”‚ â”‚ 6. container.appendChild() - DOM ë§ˆìš´íŠ¸                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë¸Œë¼ìš°ì € DOM (ì‹¤ì œ ë Œë”ë§ ê²°ê³¼)                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ <div class="scene-container" data-scene-id="scene-123"> â”‚ â”‚
â”‚ â”‚   <div class="min-h-screen bg-gray-50">                 â”‚ â”‚
â”‚ â”‚     <h1 class="text-3xl font-bold">ğŸ›ï¸ AI ì‡¼í•‘ëª°</h1>   â”‚ â”‚
â”‚ â”‚     <button data-action="add-to-cart"                   â”‚ â”‚
â”‚ â”‚             data-product="iphone-15-pro"                â”‚ â”‚
â”‚ â”‚             class="bg-blue-500 text-white px-4 py-2">  â”‚ â”‚
â”‚ â”‚       ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°                                     â”‚ â”‚
â”‚ â”‚     </button>                                           â”‚ â”‚
â”‚ â”‚   </div>                                                â”‚ â”‚
â”‚ â”‚ </div>                                                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì²˜ë¦¬

```
ì‚¬ìš©ì í´ë¦­: <button data-action="add-to-cart" data-product="iphone-15-pro">
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage ì´ë²¤íŠ¸ ìœ„ì„ ì‹œìŠ¤í…œ                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. handleClick() ì´ë²¤íŠ¸ ìºì¹˜                            â”‚ â”‚
â”‚ â”‚ 2. target.closest('[data-action]') ìš”ì†Œ ì°¾ê¸°           â”‚ â”‚
â”‚ â”‚ 3. data-action="add-to-cart" ì¶”ì¶œ                      â”‚ â”‚
â”‚ â”‚ 4. data-product="iphone-15-pro" ì¶”ì¶œ                   â”‚ â”‚
â”‚ â”‚ 5. CustomEvent('ui-action') ìƒì„±                       â”‚ â”‚
â”‚ â”‚ 6. ActionHandler.executeAction() í˜¸ì¶œ                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ActionHandler (ì•¡ì…˜ ì²˜ë¦¬ ì—”ì§„)                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 1. executeAction("add-to-cart", context)               â”‚ â”‚
â”‚ â”‚ 2. Scene ìƒíƒœ ì—…ë°ì´íŠ¸ (cartì— ì•„ì´í…œ ì¶”ê°€)             â”‚ â”‚
â”‚ â”‚ 3. Director.continueConversation() í˜¸ì¶œ                â”‚ â”‚
â”‚ â”‚    â†’ "iPhone 15 Proë¥¼ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€í–ˆì–´"              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
ë‹¤ì‹œ Director â†’ SceneManager â†’ AI í†µì‹  â†’ ìƒˆë¡œìš´ Scene ìƒì„± í”Œë¡œìš°
```

#### 3. ì—°ì† ëŒ€í™” ë° ìƒíƒœ ê´€ë¦¬

```
ConversationChain ì§„í™”:

1ë‹¨ê³„ (ë©”ì¸ í˜ì´ì§€):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ConversationChain                                           â”‚
â”‚ â”œâ”€â”€ id: "chain-123"                                         â”‚
â”‚ â”œâ”€â”€ scenes: [Scene1]                                        â”‚
â”‚ â”œâ”€â”€ currentSceneId: "scene-1"                               â”‚
â”‚ â”œâ”€â”€ context:                                                â”‚
â”‚ â”‚   â”œâ”€â”€ userInputs: ["ì‡¼í•‘ëª° ë§Œë“¤ì–´ì¤˜"]                     â”‚
â”‚ â”‚   â”œâ”€â”€ aiOutputs: [HTML_ë©”ì¸í˜ì´ì§€]                        â”‚
â”‚ â”‚   â””â”€â”€ globalState: { cart: [], user: {...} }             â”‚
â”‚ â””â”€â”€ metadata: { totalSteps: 1 }                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2ë‹¨ê³„ (ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ConversationChain (ì—…ë°ì´íŠ¸ë¨)                              â”‚
â”‚ â”œâ”€â”€ id: "chain-123"                                         â”‚
â”‚ â”œâ”€â”€ scenes: [Scene1, Scene2]                                â”‚
â”‚ â”œâ”€â”€ currentSceneId: "scene-2"                               â”‚
â”‚ â”œâ”€â”€ context:                                                â”‚
â”‚ â”‚   â”œâ”€â”€ userInputs: ["ì‡¼í•‘ëª° ë§Œë“¤ì–´ì¤˜", "iPhone ë‹´ì•˜ì–´"]     â”‚
â”‚ â”‚   â”œâ”€â”€ aiOutputs: [HTML_ë©”ì¸í˜ì´ì§€, HTML_ì¥ë°”êµ¬ë‹ˆ]          â”‚
â”‚ â”‚   â””â”€â”€ globalState: {                                      â”‚
â”‚ â”‚       cart: [{ id: "iphone-15-pro", quantity: 1 }],       â”‚
â”‚ â”‚       user: {...}                                         â”‚
â”‚ â”‚     }                                                     â”‚
â”‚ â””â”€â”€ metadata: { totalSteps: 2 }                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4. Scene ë°ì´í„° êµ¬ì¡° (ì‹¤ì œ ê²€ì¦ë¨)

```
Scene ê°ì²´ êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scene {                                                     â”‚
â”‚   id: "scene-1757928087254-f4gyxb1db",                      â”‚
â”‚   type: "window",                                           â”‚
â”‚   title: "ğŸ›ï¸ AI ì‡¼í•‘ëª°",                                   â”‚
â”‚   ui: {                                                     â”‚
â”‚     type: "html",                                           â”‚
â”‚     content: "<div class='shopping-mall'>...</div>",        â”‚
â”‚     actions: {                                              â”‚
â”‚       "[data-action='add-to-cart']": "addToCart",          â”‚
â”‚       "[data-action='show-category']": "showCategory"      â”‚
â”‚     }                                                       â”‚
â”‚   },                                                        â”‚
â”‚   state: {                                                  â”‚
â”‚     visible: true,                                          â”‚
â”‚     data: {                                                 â”‚
â”‚       cart: [],                                             â”‚
â”‚       products: [                                           â”‚
â”‚         { id: "iphone-15-pro", name: "iPhone 15 Pro" }     â”‚
â”‚       ]                                                     â”‚
â”‚     }                                                       â”‚
â”‚   },                                                        â”‚
â”‚   context: { /* ìƒìœ„ ì»¨í…ìŠ¤íŠ¸ ì •ë³´ */ },                    â”‚
â”‚   metadata: { createdAt: 1757928087254, version: 1 }        â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê²€ì¦ëœ ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤

#### ì˜¨ë¼ì¸ ì‡¼í•‘ëª° ì‹œë‚˜ë¦¬ì˜¤ (3ë‹¨ê³„)

```
1ë‹¨ê³„: ë©”ì¸ í˜ì´ì§€
request("ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì„ ë§Œë“¤ì–´ì¤˜")
   â†“
Scene: í™ˆí˜ì´ì§€ (ì¹´í…Œê³ ë¦¬, ìƒí’ˆ ëª©ë¡, ê²€ìƒ‰)
State: { cart: [], products: [...] }

2ë‹¨ê³„: ì¹´í…Œê³ ë¦¬ í•„í„°ë§  
continueConversation("ì „ìì œí’ˆ ì¹´í…Œê³ ë¦¬ ë³´ì—¬ì¤˜")
   â†“
Scene: ì „ìì œí’ˆ ëª©ë¡ (í•„í„°, ì •ë ¬, ìƒí’ˆ ì¹´ë“œ)
State: { currentCategory: "electronics", cart: [] }

3ë‹¨ê³„: ì¥ë°”êµ¬ë‹ˆ ë° ê²°ì œ
continueConversation("iPhoneì„ ì¥ë°”êµ¬ë‹ˆì— ì¶”ê°€í•´ì¤˜")
   â†“
Scene: ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ (ìˆ˜ëŸ‰ ì¡°ì ˆ, ì´ì•¡, ê²°ì œ ë²„íŠ¼)
State: { cart: [{ productId: "iphone-15-pro", quantity: 1 }], total: 1350000 }
```

### ì„±ëŠ¥ ë° í™•ì¥ì„± ê²€ì¦

#### í…ŒìŠ¤íŠ¸ ê²°ê³¼ (ì‹¤ì œ ì¸¡ì •)

```
ğŸ“Š ì „ì²´ í…ŒìŠ¤íŠ¸ í˜„í™©:
  âœ“ ì´ í…ŒìŠ¤íŠ¸ íŒŒì¼: 6ê°œ
  âœ“ ì´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤: 51ê°œ 
  âœ“ ì„±ê³µë¥ : 100% (51/51)
  âœ“ í‰ê·  ì‹¤í–‰ ì‹œê°„: 271ms

ğŸ¯ í•µì‹¬ ì„±ëŠ¥ ì§€í‘œ:
  âœ“ Director ì´ˆê¸°í™”: ~15ms
  âœ“ Scene ìƒì„±: ~50ms  
  âœ“ DOM ë Œë”ë§: ~25ms
  âœ“ ëŒ€ìš©ëŸ‰ ë°ì´í„° (1000ê°œ ì•„ì´í…œ): ~40ms
  âœ“ ì—°ì† ìš”ì²­ (5ê°œ): ~60ms ë³‘ë ¬ ì²˜ë¦¬

ğŸ”§ ë©”ëª¨ë¦¬ ê´€ë¦¬:
  âœ“ Scene êµì²´ ì‹œ ì´ì „ DOM ì™„ì „ ì •ë¦¬
  âœ“ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìë™ í•´ì œ
  âœ“ ëŒ€í™” ì²´ì¸ íš¨ìœ¨ì  ê´€ë¦¬
```

#### ì‹¤ì œ ê²€ì¦ëœ ì‹œë‚˜ë¦¬ì˜¤ë“¤

```
1. ì „ììƒê±°ë˜ ì™„ì „ ì—¬ì • (3ë‹¨ê³„)
   í™ˆí˜ì´ì§€ â†’ ì¹´í…Œê³ ë¦¬ â†’ ì¥ë°”êµ¬ë‹ˆ â†’ ê²°ì œ
   âœ“ ìƒíƒœ ì§€ì†ì„± ìœ ì§€
   âœ“ UI ì „í™˜ ë§¤ë„ëŸ¬ì›€
   âœ“ ì‚¬ìš©ì ì•¡ì…˜ ì •í™•í•œ ì²˜ë¦¬

2. ë³µì¡í•œ í¼ ìœ„ì €ë“œ (3ë‹¨ê³„)
   ê°œì¸ì •ë³´ â†’ ì£¼ì†Œì •ë³´ â†’ í™•ì¸
   âœ“ ë‹¤ë‹¨ê³„ ìƒíƒœ ì „ë‹¬
   âœ“ ë’¤ë¡œê°€ê¸° ì§€ì›
   âœ“ ë°ì´í„° ê²€ì¦

3. ì—ëŸ¬ ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤
   âœ“ ì˜ëª»ëœ AI ì‘ë‹µ â†’ Fallback ì²˜ë¦¬
   âœ“ ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ â†’ ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€
   âœ“ íƒ€ì… ì•ˆì „ì„± ìœ ì§€

4. ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬
   âœ“ 1,000ê°œ ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
   âœ“ 100KB HTML ì½˜í…ì¸  ì²˜ë¦¬
   âœ“ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì—†ìŒ
```

### AI ì„œë¹„ìŠ¤ í˜¸í™˜ì„±

#### ì§€ì›ë˜ëŠ” AI ì œê³µì—…ì²´

```
OpenAI í˜¸í™˜ì„±:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OpenAIAdapter                                               â”‚
â”‚ â”œâ”€â”€ Chat Completion API ì™„ì „ ì§€ì›                           â”‚
â”‚ â”œâ”€â”€ ëŒ€í™” ì´ë ¥ ìë™ ë³€í™˜                                     â”‚
â”‚ â”œâ”€â”€ Function Calling ì¤€ë¹„ë¨                                 â”‚
â”‚ â””â”€â”€ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì§€ì›                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Anthropic í˜¸í™˜ì„±:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AnthropicAdapter                                            â”‚
â”‚ â”œâ”€â”€ Messages API ì™„ì „ ì§€ì›                                  â”‚
â”‚ â”œâ”€â”€ System Prompt ìµœì í™”                                    â”‚
â”‚ â”œâ”€â”€ Claude 3 ëª¨ë¸ ì™„ì „ í˜¸í™˜                                 â”‚
â”‚ â””â”€â”€ ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš° íš¨ìœ¨ì  ê´€ë¦¬                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

í¬ë§· ë³€í™˜:
Director AgentRequest â†” OpenAI ChatCompletion
Director AgentRequest â†” Anthropic Messages
Director AgentResponse â† ëª¨ë“  AI ì„œë¹„ìŠ¤ ì‘ë‹µ
```

## í•µì‹¬ ì»´í¬ë„ŒíŠ¸

### 1. Director (ë©”ì¸ í´ë˜ìŠ¤)
- ì „ì²´ ì‹œìŠ¤í…œì˜ ì§„ì…ì 
- ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì˜ ì¡°ìœ¨
- ìƒëª…ì£¼ê¸° ê´€ë¦¬
- ë‹¨ì¼ API: `request(userInput: string)`

### 1-1. Stage (ë Œë”ë§ ì„œí”¼ìŠ¤)
- DOM ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸ë˜ê³ , `UIRenderer`ë¥¼ í†µí•´ Sceneì„ ë Œë”ë§
- DOM ì´ë²¤íŠ¸ ìœ„ì„(`data-action`, `form submit`)ì„ í‘œì¤€í™”í•˜ì—¬ Directorë¡œ ì „ë‹¬
- Directorì™€ì˜ ì—°ê²°ì€ ì´ë²¤íŠ¸/ì—…ë°ì´íŠ¸ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œë§Œ ì´ë£¨ì–´ì§ (ì–‘ë°©í–¥ ì˜ì¡´ ì œê±°)

### 2. Scene Management Layer
- **SceneManager**: ë©”ì¸ Scene ìƒëª…ì£¼ê¸° ê´€ë¦¬
- **SubSceneManager**: SubScene ë¶€ë¶„ ì—…ë°ì´íŠ¸ ê´€ë¦¬
- **ModalManager**: ëª¨ë‹¬ ì˜¤ë²„ë ˆì´ ê´€ë¦¬
- Scene ê°„ ê´€ê³„ ê´€ë¦¬ (ë¶€ëª¨-ìì‹, í˜•ì œ)
- ëŒ€í™”í˜• Scene ì²´ì¸ ê´€ë¦¬ (ConversationChain)

### 3. State Management Layer
- **GlobalStateManager**: ì „ì—­ ìƒíƒœ ê´€ë¦¬ (ì‚¬ìš©ì, ì•±, ì‹œìŠ¤í…œ)
- **SceneStateManager**: Sceneë³„ ìƒíƒœ ê´€ë¦¬ (UI, í¼, ì»´í¬ë„ŒíŠ¸)
- **SubSceneStateManager**: SubSceneë³„ ìƒíƒœ ê´€ë¦¬ (ë°ì´í„°, ì—…ë°ì´íŠ¸, ì—°ê²°)
- ìƒíƒœ ë™ê¸°í™” ë° ì „íŒŒ ì‹œìŠ¤í…œ

### 4. Interaction Layer
- **ActionHandler**: ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì²˜ë¦¬
- **FormManager**: í¼ ìƒíƒœ ë° ìœ íš¨ì„± ê²€ì‚¬
- **EventSystem**: ì´ë²¤íŠ¸ ìœ„ì„ ë° ë¼ìš°íŒ…
- AI ì—°ë™ ë° ëŒ€í™” ê´€ë¦¬

### 5. Rendering Layer
- **UIRenderer**: Stageê°€ ë³´ìœ í•˜ëŠ” ë Œë”ë§ ì—”ì§„ (HTML/ì»´í¬ë„ŒíŠ¸/ë¶€ë¶„ ì—…ë°ì´íŠ¸)
- **PartialUpdateEngine**: ë¶€ë¶„ ì—…ë°ì´íŠ¸ ë° ì„±ëŠ¥ ìµœì í™”
- **AnimationEngine**: ì• ë‹ˆë©”ì´ì…˜ ë° ì „í™˜ íš¨ê³¼
- **VirtualDOM**: íš¨ìœ¨ì ì¸ DOM ì¡°ì‘

### 6. Communication Layer
- **AgentCommunicationInterface**: AI ì—ì´ì „íŠ¸ í†µì‹  ì¸í„°í˜ì´ìŠ¤
- **ThirdPartyAgent**: ê¸°ì¡´ AI ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—°ë™
- **AgentCommunicationAdapter**: í†µì‹  ê´€ë¦¬ ë° ì—ëŸ¬ ì²˜ë¦¬

## Interaction Layer (ìƒí˜¸ì‘ìš© ê³„ì¸µ)

### 1. AIStateManager
- **Sceneë³„ ìƒíƒœ ê´€ë¦¬**: UI ê´€ë ¨ ìƒíƒœ (í¼ ë°ì´í„°, ë¡œë”© ìƒíƒœ ë“±)
- **ì „ì—­ ìƒíƒœ ê´€ë¦¬**: ì‚¬ìš©ì ë°ì´í„°, ì•± ì„¤ì • ë“±
- **ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬**: AIì™€ì˜ ì—°ì† ëŒ€í™”ë¥¼ ìœ„í•œ ìƒíƒœ
- **ìƒíƒœ ìˆ˜ì§‘**: ë‹¤ìŒ AI ìš”ì²­ì„ ìœ„í•œ ìƒíƒœ ë°ì´í„° ìˆ˜ì§‘

### 2. AIConversationManager
- **ì—°ì† ëŒ€í™” ì²˜ë¦¬**: ì‚¬ìš©ì ì•¡ì…˜ê³¼ AI ì‘ë‹µ ê°„ì˜ ì—°ê²°
- **ìƒíƒœ ì „ë‹¬**: í˜„ì¬ ìƒíƒœë¥¼ AIì—ê²Œ ì „ë‹¬
- **ì‘ë‹µ ì²˜ë¦¬**: AI ì‘ë‹µì„ ë°›ì•„ì„œ UI ì—…ë°ì´íŠ¸
- **ì»¨í…ìŠ¤íŠ¸ ìœ ì§€**: ëŒ€í™” íë¦„ì˜ ì—°ì†ì„± ë³´ì¥

### 3. ActionHandler (í™•ì¥)
- **ê¸°ì¡´ ê¸°ëŠ¥**: ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì²˜ë¦¬, ì´ë²¤íŠ¸ ìœ„ì„
- **ìƒˆë¡œìš´ ê¸°ëŠ¥**: AI ìƒíƒœì™€ ì—°ë™ëœ ì•¡ì…˜ ì²˜ë¦¬
- **í¼ ë°ì´í„° ìˆ˜ì§‘**: ì‚¬ìš©ì ì…ë ¥ì„ ìƒíƒœë¡œ ì €ì¥
- **AI ìš”ì²­ íŠ¸ë¦¬ê±°**: ì•¡ì…˜ ë°œìƒ ì‹œ AIì™€ì˜ ëŒ€í™” ì‹œì‘

## Rendering Layer (ë Œë”ë§ ê³„ì¸µ)

### 1. HybridUIRenderer
- **ë‹¤ì¤‘ ë Œë”ë§ ë°©ì‹ ì§€ì›**: HTML, ì»´í¬ë„ŒíŠ¸, JSON ê¸°ë°˜
- **AI ì‘ë‹µ íŒŒì‹±**: AI ì‘ë‹µì„ UI ì •ì˜ë¡œ ë³€í™˜
- **Tailwind CSS ì ìš©**: barocss/browserì™€ ì—°ë™
- **ë™ì  ë Œë”ë§**: ì‹¤ì‹œê°„ UI ìƒì„± ë° ì—…ë°ì´íŠ¸

### 2. AISceneProcessor
- **AI ì‘ë‹µ ì²˜ë¦¬**: ë‹¤ì–‘í•œ í˜•íƒœì˜ AI ì‘ë‹µ íŒŒì‹±
- **UI íƒ€ì… ê°ì§€**: HTML, ì»´í¬ë„ŒíŠ¸, JSON ìë™ ê°ì§€
- **Scene ìƒì„±**: AI ì‘ë‹µì„ Sceneìœ¼ë¡œ ë³€í™˜
- **ì•¡ì…˜ ë§¤í•‘**: UI ì•¡ì…˜ì„ AI ëŒ€í™”ì™€ ì—°ê²°


## ë°ì´í„° ëª¨ë¸

### Context Hierarchy
```
GlobalContext
â”œâ”€â”€ Application Info
â”œâ”€â”€ User Info
â””â”€â”€ System Info

SessionContext
â”œâ”€â”€ Navigation History
â”œâ”€â”€ Session State
â””â”€â”€ Temporary Data

SceneContext
â”œâ”€â”€ Scene Info
â”œâ”€â”€ Parent-Child Relations
â”œâ”€â”€ Scene State
â””â”€â”€ Scene Data

ComponentContext
â”œâ”€â”€ Component Info
â”œâ”€â”€ Props & State
â””â”€â”€ Lifecycle State

TemporaryContext
â”œâ”€â”€ Request Data
â”œâ”€â”€ Metadata
â””â”€â”€ Expiration
```

### AI State Management
```
AIStateManager
â”œâ”€â”€ Scene States (Map<sceneId, Map<key, value>>)
â”‚   â”œâ”€â”€ Form Data
â”‚   â”œâ”€â”€ UI State (loading, error, etc.)
â”‚   â””â”€â”€ Component State
â”œâ”€â”€ Global States (Map<key, value>)
â”‚   â”œâ”€â”€ User Data
â”‚   â”œâ”€â”€ App Settings
â”‚   â””â”€â”€ Theme Preferences
â””â”€â”€ Conversation Context (Map<key, value>)
    â”œâ”€â”€ Last Action
    â”œâ”€â”€ Step Counter
    â””â”€â”€ AI Memory
```

### AI Response Format
```
AgentResponse
â”œâ”€â”€ type: 'success' | 'error' | 'partial'
â”œâ”€â”€ data
â”‚   â””â”€â”€ result
â”‚       â”œâ”€â”€ ui (AISceneDefinition)
â”‚       â”‚   â”œâ”€â”€ type: 'html' | 'components' | 'scene'
â”‚       â”‚   â”œâ”€â”€ content?: string (HTML + Tailwind)
â”‚       â”‚   â”œâ”€â”€ components?: ComponentDefinition[]
â”‚       â”‚   â”œâ”€â”€ scene?: SceneDefinition
â”‚       â”‚   â”œâ”€â”€ actions?: Record<string, string>
â”‚       â”‚   â”œâ”€â”€ state?: Record<string, any>
â”‚       â”‚   â””â”€â”€ context?: Record<string, any>
â”‚       â””â”€â”€ message?: string
â””â”€â”€ metadata
```

### Request/Response Flow
```
User Input â†’ Director.request() â†’ SceneManager â†’ ContextAggregator â†’ AIRequestBuilder â†’ AgentCommunication â†’ AI Agent
                â†“
AI Agent â†’ AgentCommunication â†’ (parse/process) â†’ SceneManager â†’ Stage(UIRenderer) â†’ DOM
                â†“
SceneManager â† (ìƒˆ Scene ìƒì„±/ì—…ë°ì´íŠ¸)
Stage â†” Director (events: scene_create/scene_update/user_action)
```

### AI UI Generation Flow
```
1. User Input ("ë¡œê·¸ì¸ í¼ì„ ë§Œë“¤ì–´ì¤˜")
   â†“
2. SceneManager.request() (ëŒ€í™” ì²´ì¸ ê´€ë¦¬)
   â†“
3. ContextAggregator (ì´ì „ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ ì§‘ê³„)
   â†“
4. AIRequestBuilder (AI ìš”ì²­ ìƒì„±)
   â†“
5. AgentCommunication â†’ AI Agent
   â†“
6. AI Response (HTML/Components/JSON)
   â†“
7. AISceneProcessor (íŒŒì‹± ë° íƒ€ì… ê°ì§€)
   â†“
8. SceneManager (ìƒˆ Scene ìƒì„± ë° ì²´ì¸ì— ì¶”ê°€)
   â†“
9. Stage/UIRenderer (ë Œë”ë§)
   â†“
10. DOM (ìµœì¢… ë Œë”ë§)
```

### Conversation Chain Flow
```
1. director.request("ì²« ë²ˆì§¸ ìš”êµ¬ì‚¬í•­")
   â†“
2. Root Scene ìƒì„± + AI ìš”ì²­ + Scene ìƒì„±
   â†“
3. director.request("ë‘ ë²ˆì§¸ ìš”êµ¬ì‚¬í•­")
   â†“
4. ì´ì „ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ í¬í•¨ + AI ìš”ì²­ + ìƒˆ Scene ìƒì„±
   â†“
5. director.request("ì„¸ ë²ˆì§¸ ìš”êµ¬ì‚¬í•­")
   â†“
6. ëª¨ë“  ì´ì „ ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ í¬í•¨ + AI ìš”ì²­ + ìƒˆ Scene ìƒì„±
   â†“
7. ê³„ì† ë°˜ë³µ...
```

## í†µì‹  í”„ë¡œí† ì½œ

### Third-party Agent í†µì‹ 
```typescript
// Third-party Agent ì¸í„°í˜ì´ìŠ¤
interface ThirdPartyAgent {
  name: string;
  type: string;
  sendRequest(request: AgentRequest): Promise<AgentResponse>;
  sendStreamRequest?(request: AgentRequest): Promise<AsyncIterable<AgentResponse>>;
  isConnected(): boolean;
  connect?(): Promise<void>;
  disconnect?(): Promise<void>;
  getStats?(): Record<string, any>;
}

// Director ìš”ì²­/ì‘ë‹µ í˜•ì‹
interface AgentRequest {
  id: string;
  type: 'create_scene' | 'update_scene' | 'delete_scene' | 'navigate' | 'user_action' | 'ai_query' | 'custom';
  payload: any;
  context: ContextHierarchy;
  metadata: RequestMetadata;
}

interface AgentResponse {
  id: string;
  requestId: string;
  type: 'success' | 'error' | 'partial' | 'redirect';
  data: any;
  status: ResponseStatus;
  metadata: ResponseMetadata;
}
```

## ë³´ì•ˆ ë° ì„±ëŠ¥

### ë³´ì•ˆ
- ë°ì´í„° ê²€ì¦ ë° ê²€ì¦
- ì…ë ¥ ê°’ ì‚´ê· í™”
- ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬

### ì„±ëŠ¥
- ë©”ëª¨ë¦¬ ê´€ë¦¬ ë° ê°€ë¹„ì§€ ì»¬ë ‰ì…˜
- ê°€ìƒí™” ë° ì§€ì—° ë¡œë”©
- ìºì‹± ì „ëµ

## í™•ì¥ì„±

### í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ
- ì»¤ìŠ¤í…€ ì•¡ì…˜ í•¸ë“¤ëŸ¬
- ì»¤ìŠ¤í…€ ë Œë”ëŸ¬
- ì»¤ìŠ¤í…€ í†µì‹  í”„ë¡œí† ì½œ

### ë§ˆì´í¬ë¡œí”„ë¡ íŠ¸ì—”ë“œ ì§€ì›
- ëª¨ë“ˆ ê²©ë¦¬
- ë…ë¦½ì  ë°°í¬
- ì„œë¹„ìŠ¤ ê°„ í†µì‹ 

## ê°œë°œì ê²½í—˜

### ë””ë²„ê¹… ë„êµ¬
- ì‹¤ì‹œê°„ ìƒíƒœ ëª¨ë‹ˆí„°ë§
- ì´ë²¤íŠ¸ ì¶”ì 
- ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§

### í…ŒìŠ¤íŠ¸ ì§€ì›
- Mock ê°ì²´ ì œê³µ
- í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹°
- í†µí•© í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬

## ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ

### ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ì˜ í˜¸í™˜ì„±
- ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜
- ë ˆê±°ì‹œ API ì§€ì›
- ë°ì´í„° ë³€í™˜ ë„êµ¬

### ë¡¤ë°± ê³„íš
- ì²´í¬í¬ì¸íŠ¸ ì‹œìŠ¤í…œ
- ìë™ ë¡¤ë°±
- ë°ì´í„° ë³µêµ¬
